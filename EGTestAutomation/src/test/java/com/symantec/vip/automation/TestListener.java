package com.symantec.vip.automation;import java.io.File;import java.io.IOException;import java.util.Set;import org.apache.commons.io.FileUtils;import org.apache.log4j.Logger;import org.openqa.selenium.OutputType;import org.openqa.selenium.TakesScreenshot;import org.openqa.selenium.WebDriver;import org.testng.ITestContext;import org.testng.ITestNGMethod;import org.testng.ITestResult;import org.testng.TestListenerAdapter;import ru.yandex.qatools.allure.annotations.Attachment;public class TestListener extends TestListenerAdapter {	static Logger logger = Logger.getLogger("VIP_EG_AUTOMATION");	WebDriver driver = null;	@Override	public void onTestStart(ITestResult tr) {		logger.info("**********Thread-" + Thread.currentThread().getId() + ": " + "STARTING TEST: << " + tr.getName() + " >>**********");	}	@Override	public void onTestSuccess(ITestResult tr) {		logger.info("**********Thread-" + Thread.currentThread().getId() + ": " + "ENDING TEST: << " + tr.getName() + " >> PASSED**********");	}	public void onTestFailure(ITestResult tr, WebDriver driver1) {		saveScreenshot();		logger.info("**********Thread-" + Thread.currentThread().getId() + ": " + "TEST STATUS: TEST << " + tr.getName() + " >> FAILED**********");		this.driver = driver1;		File scrFile = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);		try {			FileUtils.copyFile(scrFile, new File("%temp%//vipeg//" + tr.getName() + ".png"));		} catch (IOException e) {			e.printStackTrace();		}	}	@Override	public void onTestSkipped(ITestResult tr) {		logger.info("**********Thread-" + Thread.currentThread().getId() + ": " + "TEST STATUS: TEST << " + tr.getName() + " >> SKIPPED**********");	}	@Override	public void onFinish(ITestContext context) {		Set<ITestResult> failedTests = context.getFailedTests().getAllResults();		for (ITestResult temp : failedTests) {			ITestNGMethod method = temp.getMethod();			if (context.getFailedTests().getResults(method).size() > 1) {				failedTests.remove(temp);			} else {				if (context.getPassedTests().getResults(method).size() > 0) {					failedTests.remove(temp);				}			}		}	}	@Attachment(value = "Failure in method {0}", type = "image/png")	private byte[] saveScreenshot() {		logger.info("Thread-" + Thread.currentThread().getId() + ": " + "********** Test failure**********. Taking screenshot and adding as attachement");		return ((TakesScreenshot) driver).getScreenshotAs(OutputType.BYTES);	}}